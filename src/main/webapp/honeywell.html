<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
     

<link rel="stylesheet" href="common/api/css/lib/textMiddle.css">
 <script src="videonetics/lib/js/trinity/parameter.js"></script>
 
<script src="common/api/js/lib/xhr.js"></script>

<style>


.centered {
  position: absolute;
  top: 50%;
  left: 50%;
      transform: translate(-50%, -50%);
       font-size: 40px;
      color: wheat;
}
</style>
</head>
<body style="padding: 0;margin: 0;height: 100vh;width: 100vw;/*background-color: #f0f0f0;*/background-color: black;">
<!-- <form id="moodleform" target="iframe"
      method="post" action="http://www.example.com/login/index.php" >
    <input type="hidden" name="username" value="guest"/>
    <input type="hidden" name="password" value="guest"/>
    <input type="hidden" name="testcookies" value="1"/>
</form> -->
<!-- <iframe name="iframe"></iframe> -->
 <!--  <img  id="SingleStream" src="common/media/loading/loading_w.gif" class="centered" alt="Smiley face">  -->
   <p id="livestatus"  class="centered"  >Loading....</p>

<script type="text/javascript">
window.LiveStreamObject={
		camera:{},
		functions:{config:{},middle:{}},
		trinity:{middle:{}},
		
		honeywell:{dvm:{}}
}


LiveStreamObject.functions.middle.sucess=function(result)
{ 
	LiveStreamObject.honeywell.dvm.active = result.activeDVMServer;
//http://dvmservera/hwdvswebserver/videoplayerhost.asp?cameranumber=0&siteid=1
	LiveStreamObject.honeywell.dvm.livestream="http://"+result.activeDVMServer+"/hwdvswebserver/videoplayerhost.asp?cameranumber="+LiveStreamObject.camera.c+"&siteid=1";//LiveStreamObject.trinity.middle.serverId
		
	  location.href = LiveStreamObject.honeywell.dvm.livestream;

}
LiveStreamObject.functions.middle.fail=function(a,b)
{
	if(a== null)
		{
		 document.getElementById("livestatus").innerHTML = "Some thing went wrong";
			console.log("Error :: NOT DONE::"+b);
		}
	else if(a==0)
		{
		
		
		 document.getElementById("livestatus").innerHTML = "Server not available ";
		 
		}
	else
	{
	
	
	 document.getElementById("livestatus").innerHTML = "Please check Middleware server <br/> Status Code : "+a;
	 
	}
	//alert("middle Faild ");
}

LiveStreamObject.functions.config.sucess=function(response)
{ 


	//LiveStreamObject.trinity.middle.ip="192.168.1.74";
	LiveStreamObject.trinity.middle.ip=response.data.profileDetails.vmsIp;
	LiveStreamObject.trinity.middle.port=response.data.profileDetails.vmsPort;
	LiveStreamObject.trinity.middle.serverId=response.data.profileDetails.vmsServerId;
	
	
	

	LiveStreamObject.trinity.middle.url = "http://"+LiveStreamObject.trinity.middle.ip+":"+LiveStreamObject.trinity.middle.port+"/DVMIntegration/DVMIntegration"+ "/activeDVMserver";
let payloadjson= {};

postJSONOnRequest(LiveStreamObject.trinity.middle.url,null,LiveStreamObject.functions.middle.sucess,LiveStreamObject.functions.middle.fail,"application/json;charset=UTF-8");

}
LiveStreamObject.functions.config.fail=function()
{
	if(a== null)
	{
	 document.getElementById("livestatus").innerHTML = "Some thing went wrong";
		console.log("Error :: NOT DONE::"+b);
	}
	else if(a==0)
	{
	
	
	 document.getElementById("livestatus").innerHTML = "Server not available ";
	 
	}
else
	{
	 document.getElementById("livestatus").innerHTML = "Fetching Configuration Failed <br/> Status Code : "+a;
	 
	}
}
LiveStreamObject.camera.c=findGetParameter("c");
LiveStreamObject.camera.t=findGetParameter("t");
LiveStreamObject.camera.p=findGetParameter("p");

////http://dvmservera/hwdvswebserver/videoplayerhost.asp?cameranumber=0&siteid=1
var url="/TrinityLiveStream/api/vmsProfile/get/VmsConfigProfile?companyId="+LiveStreamObject.camera.t+"&profileId="+LiveStreamObject.camera.p;

getJSONOnRequest(url,LiveStreamObject.functions.config.sucess,LiveStreamObject.functions.config.fail,"application/json;charset=UTF-8");
//    document.getElementById('moodleform').submit();
</script>
</body>
</html>